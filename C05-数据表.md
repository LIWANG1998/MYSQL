在创建数据库之后，接下来就要在数据库中创建数据表。所谓创建数据表，指的是在已经创建的数据库中建立新表。

创建数据表的过程是规定数据列的属性的过程，同时也是实施数据完整性（包括实体完整性、引用完整性和域完整性）约束的过程。接下来我们介绍一下创建数据表的语法形式。

# 一、创建数据表

## 1. 语法

```mysql
CREATE TABLE <表名> ([表定义选项])[表选项][分区选项];
```

其中，表定义选项的格式为：

```mysql
<列名1> <类型1> [,…] <列名n> <类型n>
```

CREATE TABLE 语句的主要语法及使用说明如下：

- CREATE TABLE：用于创建给定名称的表，必须拥有表CREATE的权限。
- <表名>：指定要创建表的名称，在 CREATE TABLE 之后给出，必须符合标识符命名规则。表名称被指定为 db_name.tbl_name，以便在特定的数据库中创建表。无论是否有当前数据库，都可以通过这种方式创建。在当前数据库中创建表时，可以省略 db-name。如果使用加引号的识别名，则应对数据库和表名称分别加引号。例如，'mydb'.'mytbl' 是合法的，但 'mydb.mytbl' 不合法。
- <表定义选项>：表创建定义，由列名（col_name）、列的定义（column_definition）以及可能的空值说明、完整性约束或表索引组成。
- 默认的情况是，表被创建到当前的数据库中。若表已存在、没有当前数据库或者数据库不存在，则会出现错误。

> 提示：使用 CREATE TABLE 创建表时，必须指定以下信息：
>
> - 要创建的表的名称不区分大小写，不能使用SQL语言中的关键字，如DROP、ALTER、INSERT等。
> - 数据表中每个列（字段）的名称和数据类型，如果创建多个列，要用逗号隔开。

## 2. 示例

**-> 在指定数据库中创建表：**

数据表属于数据库，在创建数据表之前，应使用语句“USE<数据库>”指定操作在哪个数据库中进行，如果没有选择数据库，就会抛出 No database selected 的错误。

创建信息表，表结构如下所示：

| 字段名称 | 数据类型    | 备注         |
| -------- | ----------- | ------------ |
| id       | INT         | 标识         |
| name     | VARCHAR(25) | 员工名称     |
| major    | VARCHAR(65) | 所在部门编号 |
| age      | INT         | 工资         |
| tel      | INT         | 电话         |
创建并查看表：
```mysql
mysql> CREATE TABLE test_db.infos (
    -> id INT AUTO_INCREMENT,
    -> name VARCHAR(25),
    -> major VARCHAR(65),
    -> age INT,
    -> tel INT,
    -> PRIMARY KEY(id));
Query OK, 0 rows affected (0.04 sec)

mysql> SHOW TABLES;
+-------------------+
| Tables_in_test_db |
+-------------------+
| infos             |
+-------------------+
1 row in set (0.00 sec)
```

**-> 查看表结构：**

语法形式：

```mysql
DESC <表名>; 
SHOW CREATE TABLE <表名>;
```

代码示例：

```mysql
mysql> DESC infos;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(25) | YES  |     | NULL    |                |
| major | varchar(65) | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| tel   | int(11)     | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)
```

# 二、修改数据表

为实现数据库中表规范化设计的目的，有时候需要对之前已经创建的表进行结构修改或者调整。

在 MySQL中可以使用 **ALTER TABLE** 语句来改变原有表的结构，例如增加或删减列、创建或取消索引、更改原有列类型、重新命名列或表等。

常用的语法格式如下：

```mysql
ALTER TABLE <表名> [修改选项]
```

修改选项的语法格式如下：

```mysql
{ ADD COLUMN <列名> <类型>
| CHANGE COLUMN <旧列名> <新列名> <新列类型>
| ALTER COLUMN <列名> { SET DEFAULT <默认值> | DROP DEFAULT }
| MODIFY COLUMN <列名> <类型>
| DROP COLUMN <列名>
| RENAME TO <新表名> }
```

## 1. 添加字段

```mysql
ALTER TABLE <表名> ADD <新字段名> <数据类型> [约束条件] [FIRST|AFTER 已存在的字段名];
```

- `新字段名`为需要添加的字段的名称；
- `FIRST` 为可选参数，其作用是将新添加的字段设置为表的第一个字段；
- `AFTER` 为可选参数，其作用是将新添加的字段添加到指定的`已存在的字段名`的后面。

代码示例：在infos表中的age字段后添加一个email字段，示例如下：

```mysql
mysql> ALTER TABLE infos 
    -> ADD email VARCHAR(65) AFTER age;
Query OK, 0 rows affected (0.05 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESC infos;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(25) | YES  |     | NULL    |                |
| major | varchar(65) | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| email | varchar(65) | YES  |     | NULL    |                |
| tel   | int(11)     | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)
```

> 提示：“FIRST 或 AFTER 已存在的字段名”用于指定新增字段在表中的位置，如果 SQL 语句中没有这两个参数，则默认将新添加的字段设置为数据表的最后列。

## 2. 修改字段类型

```mysql
ALTER TABLE <表名> MODIFY <字段名> <数据类型>;
```

- `表名`指要修改数据类型的字段所在表的名称
- `字段名`指需要修改的字段
- `数据类型`指修改后字段的新数据类型。

代码示例：将name字段的数据类型从 `varchar(25)` 修改为 `varchar(65)` ，示例如下：

```mysql
mysql> ALTER TABLE infos
    -> MODIFY name VARCHAR(65);
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESC infos;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(65) | YES  |     | NULL    |                |
| major | varchar(65) | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| email | varchar(65) | YES  |     | NULL    |                |
| tel   | int(11)     | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)
```

语句执行后，发现表 test_db 中 name 字段的数据类型已经修改成 VARCHAR(65)，修改成功。

## 3. 删除字段

```mysql
ALTER TABLE <表名> DROP <字段名>；
```

代码示例：删除email字段，示例如下：

```mysql
mysql> ALTER TABLE infos
    -> DROP email;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESC infos;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(65) | YES  |     | NULL    |                |
| major | varchar(65) | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| tel   | int(11)     | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)
```

可以看到，email字段已经被删除

## 4. 修改字段名称

```mysql
ALTER TABLE <表名> CHANGE <旧字段名> <新字段名> <新数据类型>；
```

- `旧字段名`：指修改前的字段名；
- `新字段名`：指修改后的字段名；
- `新数据类型`：指修改后的数据类型，如果不需要修改字段的数据类型，可以将新数据类型设置成与原来一样，但数据类型不能为空。

代码示例：将tel修改成email，数据类型为varchar(65)，示例如下：

```mysql
mysql> ALTER TABLE infos
    -> CHANGE tel email VARCHAR(65);
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESC infos;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(65) | YES  |     | NULL    |                |
| major | varchar(65) | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| email | varchar(65) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)
```

CHANGE 也可以只修改数据类型，实现和 MODIFY 同样的效果，方法是将 SQL 语句中的“新字段名”和“旧字段名”设置为相同的名称，只改变“数据类型”。

> 提示：由于不同类型的数据在机器中的存储方式及长度并不相同，修改数据类型可能会影响数据表中已有的数据记录，因此，当数据表中已经有数据时，不要轻易修改数据类型。

## 5. 修改表名

```mysql
ALTER TABLE <旧表名> RENAME [TO] <新表名>；
```

> 提示：`TO` 为可选参数，使用与否均不影响结果。

代码示例：将infos修改为stu_infos。

```mysql
mysql> ALTER TABLE infos RENAME stu_infos;
Query OK, 0 rows affected (0.03 sec)

mysql> SHOW TABLES;
+-------------------+
| Tables_in_test_db |
+-------------------+
| stu_infos         |
+-------------------+
1 row in set (0.01 sec)
```

# 三、删除数据表

## 1. 语法

```mysql
DROP TABLE [IF EXISTS] <表名> [ , <表名1> , <表名2>] …
```

语法说明如下：

- <表名>：被删除的表名。DROP TABLE 语句可以同时删除多个表，用户必须拥有该命令的权限。
- 表被删除时，所有的表数据和表定义会被取消，所以使用本语句要小心。
- 表被删除时，用户在该表上的权限并不会自动被删除。
- 参数 `IF EXISTS` 用于在删除前判断删除的表是否存在，加上该参数后，在删除表的时候，如果表不存在，SQL 语句可以顺利执行，但会发出警告（warning）。

## 2. 示例

首先创建teachers表

```mysql
mysql> CREATE TABLE teachers(
    -> id INT,
    -> name VARCHAR(65),
    -> age INT,
    -> PRIMARY KEY(id)
    -> );
Query OK, 0 rows affected (0.04 sec)

mysql> DESC teachers;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int(11)     | NO   | PRI | NULL    |       |
| name  | varchar(65) | YES  |     | NULL    |       |
| age   | int(11)     | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
3 rows in set (0.00 sec)
```

然后删除teachers表并查看：

```mysql
mysql> DROP TABLE teachers;
Query OK, 0 rows affected (0.02 sec)

mysql> SHOW TABLES;
+-------------------+
| Tables_in_test_db |
+-------------------+
| stu_infos         |
+-------------------+
1 row in set (0.00 sec)
```

# 四、约束

## 1. 主键约束

主键约束是一个列或者列的组合，其值能唯一地标识表中的每一行。这样的一列或多列称为表的主键，通过它可以强制表的实体完整性。

### 1.1. 选取设置主键约束的字段

主键约束即在表中定义一个主键来唯一确定表中每一行数据的标识符。主键可以是表中的某一列或者多列的组合，其中由多列组合的主键称为复合主键。主键应该遵守下面的规则：

- 每个表只能定义一个主键。
- 主键值必须唯一标识表中的每一行，且不能为 NULL，即表中不可能存在两行数据有相同的主键值。这是唯一性原则。
- 一个列名只能在复合主键列表中出现一次。
- 复合主键不能包含不必要的多余列。当把复合主键的某一列删除后，如果剩下的列构成的主键仍然满足唯一性原则，那么这个复合主键是不正确的。这是最小化原则。

### 1.2. 在创建表时设置主键约束

```mysql
<字段名> <数据类型> PRIMARY KEY [默认值]
```

以下举例两种设置主键的方法：

1）在设置字段的时候直接指定主键约束

```mysql
mysql> CREATE TABLE stu_1
    -> (
    -> id INT PRIMARY KEY,
    -> name VARCHAR(65)
    -> );
Query OK, 0 rows affected (0.07 sec)

mysql> DESC stu_1;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int(11)     | NO   | PRI | NULL    |       |
| name  | varchar(65) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec)
```

2）在定义完字段之后再指定主键约束

```mysql
mysql> CREATE TABLE stu_2
    -> (
    -> id INT,
    -> name VARCHAR(65),
    -> PRIMARY KEY(id)
    -> );
Query OK, 0 rows affected (0.04 sec)

mysql> DESC stu_2;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int(11)     | NO   | PRI | NULL    |       |
| name  | varchar(65) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec)
```

### 1.3. 在修改表时设置主键约束

在修改数据表时添加主键约束的语法规则为：

```mysql
ALTER TABLE <数据表名> ADD PRIMARY KEY(<列名>);
```

查看表：

```mysql
mysql> DESC stu_infos;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| name  | varchar(65) | YES  |     | NULL    |       |
| major | varchar(65) | YES  |     | NULL    |       |
| age   | int(11)     | YES  |     | NULL    |       |
| email | varchar(65) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
4 rows in set (0.00 sec)
```

添加一个id属性，并设置为主键：

```mysql
mysql> ALTER TABLE stu_infos
    -> ADD id INT PRIMARY KEY;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> DESC stu_infos;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| name  | varchar(65) | YES  |     | NULL    |       |
| major | varchar(65) | YES  |     | NULL    |       |
| age   | int(11)     | YES  |     | NULL    |       |
| email | varchar(65) | YES  |     | NULL    |       |
| id    | int(11)     | NO   | PRI | NULL    |       |
+-------+-------------+------+-----+---------+-------+
5 rows in set (0.00 sec)
```

## 2. 外键约束

外键约束**FOREIGN KEY**，保持数据一致性，完整性，实现**一对一或一对多**关系。一个表的外键可以为空值，若不为空值，则每一个外键的值必须等于另一个表中主键的某个值。

外键是表的一个字段，不是本表的主键，但对应另一个表的主键。定义外键后，不允许删除另一个表中具有关联关系的行。

### 2.1. 选取设置外键约束的字段

定义一个外键时，需要遵守下列规则：

- 父表必须已经存在于数据库中，或者是当前正在创建的表。如果是后一种情况，则父表与子表是同一个表，这样的表称为自参照表，这种结构称为自参照完整性。
- 必须为父表定义主键。
- 主键不能包含空值，但允许在外键中出现空值。也就是说，只要外键的每个非空值出现在指定的主键中，这个外键的内容就是正确的。
- 在父表的表名后面指定列名或列名的组合。这个列或列的组合必须是父表的主键或候选键。
- 外键中列的数目必须和父表的主键中列的数目相同。
- 外键中列的数据类型必须和父表主键中对应列的数据类型相同。

### 2.2. 在创建表时设置外键约束

在数据表中创建外键使用 **FOREIGN KEY** 关键字，具体的语法规则如下：

```mysql
[CONSTRAINT <外键名>] FOREIGN KEY 字段名 [，字段名2，…]
REFERENCES <主表名> 主键列1 [，主键列2，…]
```

语法解读：

- `外键名`：定义的外键约束的名称，一个表中不能有相同名称的外键；

- `字段名`：表示子表需要添加外健约束的字段列；
- `主表名`：即被子表外键所依赖的表的名称；
- `主键列`：表示主表中定义的主键列或者列组合。

为了展现表与表之间的外键关系，本例在 test_db 数据库中创建一个部门表 department，表结构如下表所示。

| 字段名称 | 数据类型    | 备注     |
| -------- | ----------- | -------- |
| id       | INT         | 部门编号 |
| name     | VARCHAR(20) | 部门名称 |
| location | VARCHAR(50) | 部门位置 |

创建 department 的 SQL 语句运行结果如下所示。

```mysql
mysql> CREATE TABLE department(
    -> id INT PRIMARY KEY,
    -> name VARCHAR(20) NOT NULL,
    -> location VARCHAR(50)
    -> );
Query OK, 0 rows affected (0.01 sec)
```

创建数据表 infos，并在表 infos 上创建外键约束，让它的键 dept_id 作为外键关联到表 department 的主键 id，输入的 SQL 语句和运行结果如下所示。

```shell
mysql> CREATE TABLE infos(
    -> id INT PRIMARY KEY,
    -> name VARCHAR(20),
    -> dept_id INT,
    -> SQLARY FLOAT,
    -> CONSTRAINT dept_infos
    -> FOREIGN KEY(dept_id) REFERENCES department(id)
    -> );
Query OK, 0 rows affected (0.02 sec)

mysql> DESC infos;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| id      | int(11)     | NO   | PRI | NULL    |       |
| name    | varchar(20) | YES  |     | NULL    |       |
| dept_id | int(11)     | YES  | MUL | NULL    |       |
| SQLARY  | float       | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
4 rows in set (0.01 sec)

```

以上语句执行成功之后，在表 department 上添加了名称为 dept_infos 的外键约束，外键名称为 dept_id，其依赖于表 infos 的主键 id。

### 2.3. 在修改表时添加外键约束

在修改数据表时添加外键约束的语法规则为：

```mysql
ALTER TABLE <数据表名> ADD CONSTRAINT <索引名>
FOREIGN KEY(<列名>) REFERENCES <主表名> (<列名>);
```

```
mysql> ALTER TABLE infos 
    -> ADD CONSTRAINT dept_infos
    -> FOREIGN KEY(dept_id) REFERENCES department(id);
Query OK, 0 rows affected (0.04 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE infos;

| Table | Create Table      
| infos | CREATE TABLE `infos` (
  `id` int(11) NOT NULL,
  `name` varchar(20) DEFAULT NULL,
  `dept_id` int(11) DEFAULT NULL,
  `SQLARY` float DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `dept_infos` (`dept_id`),
  CONSTRAINT `dept_infos` FOREIGN KEY (`dept_id`) REFERENCES `department` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```



### 2.4. 删除外键约束

对于数据库中定义的外键，如果不再需要，可以将其删除。外键一旦删除，就会解除主表和从表间的关联关系，MySQL 中删除外键的语法格式如下：

```mysql
ALTER TABLE <表名> DROP FOREIGN KEY <外键约束名>;
```

```mysql
mysql> ALTER TABLE infos
    -> DROP FOREIGN KEY dept_infos;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE infos;
| infos | CREATE TABLE `infos` (
  `id` int(11) NOT NULL,
  `name` varchar(20) DEFAULT NULL,
  `dept_id` int(11) DEFAULT NULL,
  `SQLARY` float DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `dept_infos` (`dept_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

可以看到，infos 中已经不存在 FOREIGN KEY，原有的名称为 dept_infos 的外键约束删除成功。







